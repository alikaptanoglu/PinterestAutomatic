<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
	<meta name="author" content="Anirudh Goel" />

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link href='https://fonts.googleapis.com/css?family=Josefin+Sans:100,300' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Lato:300,400|Poiret+One' rel='stylesheet' type='text/css'>
    <link rel="icon" href="https://s-passets-cache-ak0.pinimg.com/webapp/style/app/common/images/favicon-57a225b2.png">
	<link rel="stylesheet" type="text/css" href="css/pin.css">


	<title>Pinterest Automatic</title>
</head>
<body>
	<div class="container" align="center">
		<div class="intro-image">
			<img src="img/pinterest.png" style="width: 530px; padding-top: 30px;" class="img-responsive">
		</div>


		<div class="input-area">
			<form onsubmit="pinThem(event);">
				<div class="col-md-6 col-sm-12 col-xs-12 title" style="padding-top: 8px;">
					<h1>Source Board</h1>
				</div>
				<div class="col-md-6 col-sm-12 col-xs-12 input-box">
					<input type="text" id="source_board" class="input-lg" placeholder="username/board">
					<div id="err1"></div>
				</div>

				<div class="col-md-6 col-sm-12 col-xs-12 title" style="padding-top: 8px;">
					<h1>Destination Board</h1>
				</div>
				<div class="col-md-6 col-sm-12 col-xs-12 input-box">
					<input type="text" id="destination_board" class="input-lg" placeholder="username/board">
					<div id="err2"></div>
				</div>
				<input type="submit" class="btn btn-lg btn-danger" value="Pin Them !">
				<br><br>
			</form>
		</div>
	</div>


	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/pin.js"></script>
	<script type="text/javascript">
		var url = window.location.href;
		var url_par = url.split("?");

		if (url_par[1] == undefined) {
			window.location = "https://localhost/PinterestAutomatic/index.html";
		} else {
			var state = url_par[1].split("&")[0];
			if (state.split("=")[0] == "state") {
				state = state.split("=")[1];

				if (state == "cookie") {
					var token = getCookie("pa-token");
					setCookie("pa-token", token, 7);
				} else if (state == "secret") {
					var code = url_par[1].split("&")[1];
					if (code == undefined) {
						window.location = "https://localhost/PinterestAutomatic/index.html";
					} else if (code.split("=")[0] != "code") {
						window.location = "https://localhost/PinterestAutomatic/index.html";
					} else if (code.split("=")[0] == "code") {
						var code_value = code.split("=")[1];
						
						$.ajax({
							type: "POST",
							url: "https://api.pinterest.com/v1/oauth/token?grant_type=authorization_code&client_id=4844984301336407368&client_secret=6a6dcd9d6a9dfdabb5ff9d5df8948c7f1a67d967e3cb8a4e68c69ab59c3a808e&code=" + code_value,
							success: function(result){
								token = result["access_token"];
								setCookie("pa-token", token, 7);
								console.log(token);
								window.location = "https://localhost/PinterestAutomatic/pin.html?state=cookie";
							},
							error: function(){
								$("body").html("<center><br><br><br><br><br><br><br><h1>Error obtaining Token...<br>Please contact the admin</h1></center>")
								setTimeout( function() {
									window.location = "https://localhost/PinterestAutomatic/index.html"
								}, 5 * 1000 );
							}
						});
					}
				} else {
					window.location = "https://localhost/PinterestAutomatic/index.html";
				}

			} else {
				window.location = "https://localhost/PinterestAutomatic/index.html";
			}
		}
	</script>
</body>
</html>